# -------------------------------------------------
# ~/.bashrc â€“ interactive non-login shell
# -------------------------------------------------

# -------------------------------------------------
# Load user-defined aliases (if the file exists)
# -------------------------------------------------
[[ -f ~/.bash_aliases ]] && . ~/.bash_aliases

# If not running interactively, stop here
[[ $- != *i* ]] && return

# -------------------------------------------------
# 1. Basic prompt (zsh-style, colored)
# -------------------------------------------------
# Show git branch in prompt
parse_git_branch() {
  git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/ (\1)/'
}

PS1='\[\e[1;32m\]\u@\h\[\e[0m\] \[\e[1;34m\]\w\[\e[0m\]\[\e[1;33m\]$(parse_git_branch)\[\e[0m\] \$ '

# -------------------------------------------------
# 2. History settings (ignore duplicates, append)
# -------------------------------------------------
HISTCONTROL=ignoreboth:erasedups
HISTSIZE=10000
HISTFILESIZE=20000
shopt -s histappend

# -------------------------------------------------
# 3. Enable programmable completion (core of zsh-like tab)
# -------------------------------------------------
if ! shopt -oq posix; then
  if [[ -f /usr/share/bash-completion/bash_completion ]]; then
    . /usr/share/bash-completion/bash_completion
  elif [[ -f /etc/bash_completion ]]; then
    . /etc/bash_completion
  fi
fi

# -------------------------------------------------
# 4. Make completion **zsh-like**
# -------------------------------------------------
# - Case-insensitive
# - Menu style (cycle with Tab)
# - Show descriptions where available
# - Colorized
bind 'set completion-ignore-case on'
bind 'set show-all-if-ambiguous on'
bind 'set colored-stats on'
bind 'set colored-completion-prefix on'
bind 'set menu-complete-display-prefix on'
bind 'set completion-display-width 1'   # one column menu
bind 'TAB: menu-complete'               # Tab = next match, Shift-Tab = previous
bind '"\e[Z": menu-complete-backward'   # Shift-Tab

# -------------------------------------------------
# 5. Additional completions (git, docker, etc.)
# -------------------------------------------------
# Git (if git is installed)
if command -v git >/dev/null; then
  __git_complete g __git_main   # g = alias for git
  __git_complete gc _git_checkout
  __git_complete gb _git_branch
  __git_complete gm _git_merge
fi

# Docker (if docker is installed)
if command -v docker >/dev/null; then
  # lazy-load docker completion to keep startup fast
  complete -F _docker docker
fi

# -------------------------------------------------
# 6. Handy aliases (feel free to edit/remove)
# -------------------------------------------------
alias ..='cd ..'
alias ...='cd ../..'
alias ll='ls -alF --color=auto'
alias la='ls -A --color=auto'
alias ls='ls --color=auto'
alias grep='grep --color=auto'
alias g='git'
alias d='docker'
alias dc='docker compose'

# -------------------------------------------------
# 7. Useful functions
# -------------------------------------------------
# cd + ls in one step
cl() { cd "$@" && ls -AF --color=auto; }

# Extract any archive
extract() {
  if [[ -f "$1" ]]; then
    case "$1" in
      *.tar.bz2)  tar xjf   "$1" ;;
      *.tar.gz)   tar xzf   "$1" ;;
      *.bz2)      bunzip2   "$1" ;;
      *.rar)      unrar x   "$1" ;;
      *.gz)       gunzip    "$1" ;;
      *.tar)      tar xf    "$1" ;;
      *.tbz2)     tar xjf   "$1" ;;
      *.tgz)      tar xzf   "$1" ;;
      *.zip)      unzip     "$1" ;;
      *.Z)        uncompress "$1" ;;
      *.7z)       7z x      "$1" ;;
      *)          echo "'$1' cannot be extracted" ;;
    esac
  else
    echo "'$1' is not a valid file"
  fi
}

# -------------------------------------------------
# 8. Final safety net
# -------------------------------------------------
# Check window size after each command
shopt -s checkwinsize

# Enable **globstar** (recursive **)
shopt -s globstar 2>/dev/null

# -------------------------------------------------
# End of .bashrc
# -------------------------------------------------
